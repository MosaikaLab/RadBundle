$em = $this->getDoctrine()->getManager();
$repository = $em->getRepository('{{ entity.doctrineName }}');
$item = new {{ entity.fullClass }}();
$form = $this->createForm('{{ entity.fullClass|replace({'Entity': 'Form'}) }}Type',$item);

$input = json_decode($request->getContent(), true);
$data = array();

foreach($form as $k => $field){
	if(isset($input[$k])){
		$data[$k] = $input[$k];
	}else if(isset($input[$k])){
		//TODO $k can be snake_case'd
	}else{
		$form->remove($k);
	}
}
if($form->submit($data)->isValid()){
    $em->persist($item);
    $em->flush();
{% if format == 'json' %}
    return $item;
{% else %}
return "";
{% endif %}
}else{
	$errors = array();
	foreach($form->getErrors() as $err){
		$errors[$err->getOrigin()->getName()] = $err->getMessage();
	}
	return new View($errors, Response::HTTP_NOT_ACCEPTABLE);
}	